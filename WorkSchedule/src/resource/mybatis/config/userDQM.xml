<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="member">
	<!-- get메소드 호출 getID -> 네이밍 룰에 의해 id 소문자를 사용한다. -->
		
	<!-- ////////////////////// login, join //////////////////////// -->
	<select id="selectemp" parameterType="model.domain.vo.EmployeeVO" resultType="model.domain.vo.EmployeeVO">
		SELECT 	*
		FROM 	EMPLOYEE A
		JOIN 	DEPARTMENT B USING (DEPTID)
		JOIN 	WORK C USING (EMPID) 
		WHERE 	EMPID = #{empid} 
	</select>
	
	<select id="selectdiv" resultType="model.domain.vo.DeptDivisionVO">
	    SELECT  	DISTINCT DIVNAME
	    FROM  		DEPARTMENT
	    JOIN  		DIVISION USING (DIVID)
	    ORDER BY 	DIVNAME
	</select>
    <select id="selectdeptdiv" resultType="model.domain.vo.EmployeeDeptVO">
    	SELECT  	DEPTNAME 
    	FROM  		DEPARTMENT
    	JOIN  		DIVISION USING (DIVID)
    	ORDER BY 	DEPTNAME
   </select>

	<select id="loginemp" parameterType="model.domain.vo.EmployeeVO" resultType="model.domain.vo.EmployeeVO">
		SELECT 	* 
		FROM 	EMPLOYEE
		WHERE 	EMPID = #{empid} AND EMPPWD = #{emppwd}	
	</select>

	 <select id="idcheck" parameterType="String" resultType="model.domain.vo.EmployeeDeptVO" > 
	  	SELECT 	* 
	  	FROM 	EMPLOYEE 
	  	JOIN 	DEPARTMENT USING (DEPTID) 
	  	WHERE 	EMPID = #{empid}
	 </select>

	 <insert id="insertemp" parameterType="model.domain.vo.EmployeeDeptDivVO" >
    	INSERT INTO EMPLOYEE
    	VALUES  	( #{empid}, #{emppwd}, #{empname}, #{empphone}, #{empmail}, #{emploc}, 
      				( SELECT DEPTID  FROM DEPARTMENT  WHERE DEPTNAME = #{deptname} ) )
     </insert>
	 
	 <insert id="insertdefaultwork" parameterType="model.domain.vo.WorkVO" >
	   	INSERT INTO WORK
		VALUES 	  ( #{tempdate}, 
					#{empid}, 
					( SELECT EMPLOC FROM EMPLOYEE WHERE EMPID = #{EMPID} ) , 
					NULL, 
					( SELECT EMPLOC FROM EMPLOYEE WHERE EMPID = #{EMPID} ), 
					NULL    )   
	 </insert>
	 
	 	 
	 
	 <!-- ////////////////////// searchview //////////////////////// -->
	 <select id="selectsearchview" parameterType="model.domain.vo.EmployeeDeptDivVO" resultType="model.domain.vo.EmployeeDeptDivVO">
		SELECT 	* 
		FROM 	EMPLOYEE A
		JOIN 	DEPARTMENT B 	USING (DEPTID)
		JOIN	DIVISION C 		USING (DIVID)
		WHERE 	EMPID != #{empid}
		AND 	EMPID != 'hr'
		AND		DEPTID = #{deptid}
	 </select>
	 
	 <insert id="addfavorite" parameterType="model.domain.vo.FavoriteVO">
	   	INSERT INTO FAVORITE
	  	VALUES 	( #{empid}, #{empidfav})
	 </insert>

	 <delete id="deletefavorite" parameterType="model.domain.vo.FavoriteVO">
	  	DELETE FROM 	FAVORITE
	  	WHERE  			EMPID = #{empid}
	  	AND 	 		EMPIDFAV = #{empidfav}
	 </delete>
	 
	 <select id="searchemp" parameterType="model.domain.vo.EmployeeDeptDivVO" resultType="model.domain.vo.EmployeeDeptDivVO">
	   SELECT 	* 
	   FROM 	EMPLOYEE
	   JOIN 	DEPARTMENT USING (DEPTID)
	   WHERE 	EMPNAME LIKE '%'||#{searchKeyword}||'%'
	   OR 		DEPTNAME LIKE '%'||#{searchKeyword}||'%'
	   AND 		EMPID != 'hr'
	   AND 		EMPID != #{empid}
 	 </select>
 	 
	 <select id="searchdept" parameterType="model.domain.vo.EmployeeDeptDivVO" resultType="model.domain.vo.EmployeeDeptDivVO">
	   SELECT 	* 
	   FROM 	EMPLOYEE
	   JOIN 	DEPARTMENT USING (DEPTID)
	   WHERE 	DEPTID = #{deptid}
 	 </select>	 
 
	 <select id="searchdiv" parameterType="model.domain.vo.EmployeeDeptDivVO" resultType="model.domain.vo.EmployeeDeptDivVO">
	   SELECT 	* 
	   FROM 	EMPLOYEE
	   JOIN 	DEPARTMENT USING (DEPTID)
	   JOIN		DIVISION USING (DIVID)
	   WHERE 	DIVID = (  SELECT DIVID
						   FROM DIVISION
						   JOIN DEPARTMENT USING (DIVID)
						   WHERE DEPTID = #{deptid} )
 	 </select>	 
  
 	 	 
	 <!-- ////////////////////////update/////////////////////// -->
	  <update id="update" parameterType="model.domain.vo.EmployeeDeptVO">
	  UPDATE 	EMPLOYEE
	  SET 		EMPID=#{empid}, 
	  			EMPPWD=#{emppwd}, 
	  			EMPNAME=#{empname}, 
	  			EMPPHONE=#{empphone},
	  			EMPMAIL=#{empmail}, 
	  			EMPLOC=#{emploc}, 
	  			DEPTID=(SELECT DEPTID FROM DEPARTMENT WHERE DEPTNAME = #{deptname})
	  WHERE 	EMPID=#{empid}
	  </update>  
	  
	  <update id="updateWork" parameterType="model.domain.vo.EmployeeDeptVO">
	  UPDATE 	WORK 
	  SET 		amloc = (select emploc from employee where empid =#{empid}), 
	   			pmloc = (select emploc from employee where empid =#{empid})
	  WHERE 	workdate >= (select to_char(sysdate, 'yyyy-MM-DD') from dual) 
	  </update>
</mapper>































